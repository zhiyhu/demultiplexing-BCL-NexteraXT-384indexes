# How to demultiplex BCL to fastq for libraries with Nextera XT 384 indexes

Resources to demultiplex BCL to fastq files based on 384 Nextera XT indexes


## Tutorials

A pdf tutorial from WHG for generating the sample sheet and using bcl2fastq:
https://www.well.ox.ac.uk/ogc/wp-content/uploads/2017/09/Bcl2FastQ2_Stand_Alone_external_B.pdf

Illumina bcl2fastq conversion user guide:
https://support.illumina.com/content/dam/illumina-support/documents/documentation/software_documentation/bcl2fastq/bcl2fastq_letterbooklet_15038058brpmi.pdf with

The shell script is "demultiplex.sh".

## Sample sheet

Illumina document explaining format of the sample sheet:
https://www.illumina.com/content/dam/illumina-marketing/documents/products/technotes/sequencing-sheet-format-specifications-technical-note-970-2017-004.pdf

Samplesheet.csv here was generated by IEM. If you'd like to use it, please check and modify:
* [Header] Instrument Type
* [Header] Index Adapters
* [Reads] length
* [Data] Lane (in the example, the data was generated from lane 2 only)
* [Data] Sample_ID (this will be a part of the fastq file names, e.g. Sample\_ID1\_S001\_L002_R1_001.fastq.gz)
* [Data] index2 (in the example, the bases for iSeq, MiniSeq, NextSeq 500/550, HiSeq 3000/4000/X, NextSeq 2000 are used. If you use NovaSeq, MiSeq, HiSeq 2000/2500, NextSeq 2000, please modify.)

It is tricky for [Data] index2. Please be careful to avoid errors. The i5 Bases for Sample Sheet depend on the model of sequencers. See pages 16-17 in [this document](https://support.illumina.com/content/dam/illumina-support/documents/documentation/chemistry_documentation/experiment-design/illumina-adapter-sequences-1000000002694-12.pdf) for more details.

It will straightforward to generate a samplesheet with illumina IEM if you have access to a Windows OS.


## Errors

* __"bcl2fastq Too many open files"__. If your sequencing run is paired end and you are not the root user, you might meet this error. More explaination is [here](https://erikclarke.net/2016/03/31/open-file-limits-and-bcl2fastq/). One way to bypass this error it to divide the sample sheet into two parts so that each time only 192 samples are being demultiplexed.





